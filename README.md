# Investfunds Market Data → Kalman Forecast (Local Linear Trend)

Проект: беру **дневные цены** по инструментам (акции и криптовалюты) из **Excel-выгрузок investfunds**, привожу данные к единому формату и строю **прогноз** с помощью модели состояний (Калмановская фильтрация) `Local Linear Trend` из `statsmodels`. Результат — график с прогнозной траекторией и вероятностным коридором.

> ⚠️ Сырые Excel-файлы не публикуются в репозитории (`data/raw/*.xlsx` в `.gitignore`).

---

## Что делает скрипт

### 1) Входные данные
- Берёт **самый свежий `.xlsx`** из папки `data/raw/`
- Поддерживает разные инструменты:
  - **акции** (например: LKOH, PLZL, TATN и т.д.)
  - **криптовалюты** (например: BTC, ETH и т.д.)
- Автоматически пытается определить **тикер/название** из имени файла

### 2) Очистка и нормализация
- Авто-поиск колонок **даты** и **цены** (разные варианты названий)
- Парсинг дат и чисел (в т.ч. форматы с пробелами/запятыми)
- Удаление пустых значений и дубликатов дат
- Сортировка по времени

### 3) Модель и прогноз
- Модель: `UnobservedComponents(level="local linear trend")`
- Обучение на последнем окне данных (`TRAIN_WINDOW`)
- Прогноз на горизонт (`HORIZON_DAYS`) в режиме:
  - `short` / `medium` / `long`
- Построение **доверительного коридора (68%)**
- Учитывает календарь:
  - **торговые дни** (business days) при заметных разрывах в датах
  - либо ежедневный календарь

### 4) Отчёт и визуализация
- Сохраняет итоговый график: `reports/forecast.png`
- На графике:
  - линия цены (история)
  - средняя прогнозная траектория
  - полоса неопределённости (68%)
- В консоль выводится summary:
  - диагностическая информация по данным
  - волатильность (лог-доходности)
  - диапазон прогноза в % к последней цене

---

## Структура проекта

```text
investfunds-local-trend/
├─ src/
│  └─ main.py
├─ data/
│  └─ raw/              # сюда кладутся .xlsx (не коммитятся)
├─ reports/
│  └─ forecast.png      # пример результата
├─ README.md
├─ requirements.txt
└─ .gitignore

