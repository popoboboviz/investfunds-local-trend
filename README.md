# Investfunds Local Trend Forecast (Kalman / State Space)

Скрипт берёт **дневные цены** по инструментам (акции и криптовалюты) из **Excel-выгрузки investfunds**, очищает данные и строит прогноз с помощью **Kalman / State Space** модели `Local Linear Trend` (statsmodels). На выходе — график с прогнозной траекторией и вероятностным коридором.

> Excel-файлы с исходными данными в репозиторий **не коммитятся** (`data/raw/*.xlsx` в `.gitignore`).

---

## Что внутри

### 1) Источник данных
- Источник: **investfunds** (Excel-выгрузки)
- Инструменты: **акции** и **криптовалюты**
- Частота: **дневные цены**

### 2) Требования к данным
Перед запуском нужно скачать историю цен **минимум за 5 лет**.

Почему 5 лет:
- модель тренда устойчивее оценивает уровень/дрейф на длинном горизонте
- меньше риск “переобучения” на коротком участке
- прогнозный коридор получается более адекватным

### 3) Обработка данных (ETL)
Скрипт автоматически:
- находит колонку **даты** и **цены** (разные варианты названий)
- приводит даты к `datetime`
- парсит цену в число (учитывает пробелы/запятые/форматы)
- удаляет пустые значения и **дубликаты дат**
- сортирует по времени
- определяет календарь (торговые дни/календарные дни) по разрывам в датах

### 4) Модель и прогноз
- Модель: `UnobservedComponents(level="local linear trend")`
- Режимы прогноза (в коде):
  - `short / medium / long` (разные окна обучения и горизонты)
- Строится:
  - средняя прогнозная траектория
  - доверительный коридор **68%**

### 5) Отчёт и визуализация
- Сохраняет итоговый график: `reports/forecast.png`
- На графике:
  - линия цены (история)
  - средняя прогнозная траектория
  - полоса неопределённости (68%)
- В консоль в
